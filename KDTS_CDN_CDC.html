<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modelo Delay-Time — Taxa de Custo</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Barlow+Condensed:wght@300;600;800&family=Barlow:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:           #0a0c10;
    --panel:        #111318;
    --border:       #1e2330;
    --accent:       #f0a500;
    --accent2:      #00d4aa;
    --accent3:      #e05260;
    --text:         #c8cdd8;
    --text-dim:     #5a6070;
    --code-bg:      #0d1117;
    --hint-bg:      #1a1f0d;
    --hint-border:  #3a5020;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ── HEADER ── */
  header {
    border-bottom: 1px solid var(--border);
    padding: 0 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(10,12,16,0.95);
    backdrop-filter: blur(10px);
  }

  .logo {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 20px;
    letter-spacing: 2px;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo span { color: var(--accent); }

  .header-right {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    letter-spacing: 1px;
  }

  .header-tag {
    padding: 4px 10px;
    border: 1px solid var(--border);
    border-radius: 2px;
    color: var(--accent2);
    border-color: var(--accent2);
  }

  /* ── LAYOUT ── */
  .container {
    display: grid;
    grid-template-columns: 280px 1fr;
    min-height: calc(100vh - 64px);
  }

  /* ── SIDEBAR ── */
  aside {
    border-right: 1px solid var(--border);
    padding: 24px 0;
    position: sticky;
    top: 64px;
    height: calc(100vh - 64px);
    overflow-y: auto;
  }

  .sidebar-section {
    padding: 8px 24px 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 10px;
    letter-spacing: 3px;
    font-weight: 600;
    color: var(--text-dim);
    margin-top: 16px;
  }

  .sidebar-item {
    padding: 10px 24px;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .sidebar-item:hover { background: rgba(255,255,255,0.03); cursor: pointer; }

  .sidebar-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    width: 22px; height: 22px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    background: rgba(240,165,0,0.15);
    color: var(--accent);
  }

  .sidebar-label {
    font-size: 13px;
    line-height: 1.3;
    color: var(--text);
  }

  /* ── MAIN ── */
  main {
    padding: 40px 50px;
    max-width: 900px;
  }

  /* ── SECTION LABEL ── */
  .section-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    letter-spacing: 3px;
    font-weight: 600;
    color: var(--text-dim);
    margin-bottom: 12px;
    margin-top: 28px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* ── EXERCISE HEADER ── */
  .ex-header {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    margin-bottom: 32px;
  }
  .ex-number-big {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 72px;
    line-height: 1;
    opacity: 0.08;
    color: #fff;
    flex-shrink: 0;
  }
  .ex-title-block { flex: 1; }
  .level-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 3px 8px;
    border-radius: 2px;
    display: inline-block;
    margin-bottom: 8px;
    background: rgba(240,165,0,0.15);
    color: var(--accent);
  }
  .ex-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 36px;
    color: #fff;
    line-height: 1.1;
  }
  .ex-subtitle {
    color: var(--text-dim);
    font-size: 13px;
    margin-top: 6px;
    font-family: 'JetBrains Mono', monospace;
  }

  /* ── PARAM PANEL ── */
  .param-panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 20px 24px;
    margin-bottom: 0;
  }

  .param-group {
    margin-bottom: 22px;
  }
  .param-group:last-child { margin-bottom: 0; }

  .group-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 10px;
    letter-spacing: 3px;
    font-weight: 600;
    color: var(--accent2);
    margin-bottom: 12px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }

  .param-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    gap: 12px;
  }
  .param-row label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    color: var(--accent);
    min-width: 36px;
    flex-shrink: 0;
  }
  .param-row .desc {
    font-size: 12px;
    color: var(--text-dim);
    flex: 1;
    line-height: 1.3;
  }
  .param-row input[type="number"] {
    width: 86px;
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    padding: 5px 9px;
    text-align: right;
    transition: border-color 0.2s;
    flex-shrink: 0;
  }
  .param-row input[type="number"]:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(240,165,0,0.1);
  }

  /* ── CONCEPTS ── */
  .concepts {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }
  .concept-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    padding: 4px 10px;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    border-radius: 3px;
    color: var(--text-dim);
  }

  /* ── ACTIONS ── */
  .actions {
    display: flex;
    gap: 12px;
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
    align-items: center;
  }

  .btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 15px;
    letter-spacing: 1px;
    padding: 10px 22px;
    border-radius: 4px;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .btn-primary {
    background: var(--accent);
    color: #000;
  }
  .btn-primary:hover { background: #ffc225; transform: translateY(-1px); }
  .btn-primary:active { transform: translateY(0); }
  .btn-primary:disabled { background: var(--text-dim); cursor: not-allowed; transform: none; }

  .btn-secondary {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }
  .btn-secondary:hover { border-color: var(--text); }

  /* ── SPINNER ── */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    width: 14px; height: 14px;
    border: 2px solid rgba(0,0,0,0.3);
    border-top-color: #000;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    display: inline-block;
  }

  /* ── PROGRESS ── */
  .progress-wrap {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 18px 20px;
  }
  .progress-top {
    display: flex;
    justify-content: space-between;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
    margin-bottom: 10px;
  }
  .progress-top span:last-child { color: var(--accent2); }
  .progress-track {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    border-radius: 2px;
    transition: width 0.3s ease;
    width: 0%;
    box-shadow: 0 0 8px var(--accent2);
  }

  /* ── RESULTS ── */
  .results-wrap {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .summary-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 16px 18px;
  }
  .card-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }
  .card-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--accent2);
  }
  .card-sub {
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 3px;
  }

  /* ── TABLE ── */
  .results-table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
  }
  .results-table th {
    text-align: left;
    padding: 10px 18px;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    background: #161b22;
    border-bottom: 1px solid var(--border);
  }
  .results-table td {
    padding: 10px 18px;
    border-bottom: 1px solid rgba(30,35,48,0.6);
    transition: background 0.15s;
  }
  .results-table tr:last-child td { border-bottom: none; }
  .results-table tr:hover td { background: rgba(255,255,255,0.02); }
  .results-table .k-col  { color: var(--text-dim); }
  .results-table .c-col  { color: var(--text); font-weight: 700; }
  .results-table tr.best td { background: rgba(0,212,170,0.06); }
  .results-table tr.best .c-col { color: var(--accent2); }

  .best-badge {
    font-size: 9px;
    background: rgba(0,212,170,0.2);
    color: var(--accent2);
    padding: 2px 7px;
    border-radius: 2px;
    margin-left: 8px;
    letter-spacing: 1px;
    font-weight: 400;
  }

  /* ── FORMULA BOX ── */
  .formula-box {
    background: var(--hint-bg);
    border: 1px solid var(--hint-border);
    border-left: 3px solid var(--accent2);
    border-radius: 4px;
    padding: 14px 18px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: #8aa860;
    line-height: 1.8;
  }
  .formula-box .formula-title {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--accent2);
    margin-bottom: 8px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 3px;
  }

  /* ── ERROR ── */
  .error-box {
    background: rgba(224,82,96,0.1);
    border: 1px solid rgba(224,82,96,0.3);
    border-radius: 6px;
    padding: 14px 18px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: #ff8080;
  }

  /* ── PLACEHOLDER ── */
  .placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    gap: 14px;
    color: var(--text-dim);
  }
  .placeholder svg { opacity: 0.25; }
  .placeholder p {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    letter-spacing: 1px;
    text-align: center;
  }

  /* ── TOAST ── */
  .toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent2);
    border-radius: 6px;
    padding: 12px 20px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--accent2);
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s;
    z-index: 999;
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  /* ── SCROLLBAR ── */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  @media (max-width: 768px) {
    .container { grid-template-columns: 1fr; }
    aside { display: none; }
    main { padding: 24px 20px; }
    header { padding: 0 20px; }
  }

  /* ── MODAL DE FÓRMULAS ── */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(4px);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--panel);
    border: 1px solid var(--border);
    border-top: 3px solid var(--accent2);
    border-radius: 8px;
    width: 660px;
    max-width: 92vw;
    max-height: 85vh;
    overflow-y: auto;
    transform: translateY(16px);
    transition: transform 0.25s;
  }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal-header {
    padding: 18px 24px 14px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .modal-header-left { display: flex; align-items: center; gap: 12px; }
  .modal-icon {
    width: 30px; height: 30px;
    border-radius: 4px;
    background: rgba(0,212,170,0.15);
    color: var(--accent2);
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px; font-weight: 700;
    display: flex; align-items: center; justify-content: center;
  }
  .modal-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800; font-size: 20px; color: #fff;
  }
  .modal-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px; color: var(--text-dim);
    margin-top: 2px; letter-spacing: 1px;
  }
  .modal-close {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-dim);
    width: 28px; height: 28px;
    border-radius: 4px; cursor: pointer;
    font-size: 14px; transition: all 0.15s;
    display: flex; align-items: center; justify-content: center;
  }
  .modal-close:hover { border-color: var(--accent3); color: var(--accent3); }
  .modal-body { padding: 20px 24px; display: flex; flex-direction: column; gap: 16px; }
  .formula-card {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 6px; overflow: hidden;
  }
  .formula-card-header {
    padding: 10px 16px;
    background: #161b22;
    border-bottom: 1px solid var(--border);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px; letter-spacing: 2px;
    font-weight: 600; color: var(--accent);
    text-transform: uppercase;
  }
  .formula-card-body {
    padding: 20px; text-align: center; overflow-x: auto;
    min-height: 60px; display: flex; align-items: center; justify-content: center;
  }
  .formula-card-desc {
    padding: 12px 16px 14px;
    font-size: 12.5px; color: var(--text-dim);
    line-height: 1.6;
    border-top: 1px solid var(--border);
  }
  .formula-card-desc code {
    font-family: 'JetBrains Mono', monospace;
    background: rgba(255,255,255,0.06);
    padding: 1px 5px; border-radius: 3px;
    font-size: 11px; color: var(--accent2);
  }
  .sidebar-item .hint-dot {
    margin-left: auto;
    font-size: 9px;
    color: var(--accent2);
    opacity: 0.5;
    font-family: 'JetBrains Mono', monospace;
    transition: opacity 0.2s;
  }
  .sidebar-item:hover .hint-dot { opacity: 1; }
</style>

<script>
  window.MathJax = {
    tex: { inlineMath: [['$','$']], displayMath: [['$$','$$']] },
    svg: { fontCache: 'global' },
    startup: { typeset: false }
  };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-svg.min.js"></script>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">KDTS<span>·</span></div>
  <div class="header-right">
    <span class="header-tag">MODELO DE MANUTENÇÃO</span>
  </div>
</header>

<div class="container">

  <!-- SIDEBAR -->
  <aside>
    <div class="sidebar-section">DISTRIBUIÇÕES</div>
    <div class="sidebar-item" onclick="openModal('modal-weibull')">
      <div class="sidebar-num">W</div>
      <div class="sidebar-label">Mistura Weibull</div>
      <span class="hint-dot">∑</span>
    </div>
    <div class="sidebar-item" onclick="openModal('modal-exp')">
      <div class="sidebar-num">E</div>
      <div class="sidebar-label">Delay-time e Choques</div>
      <span class="hint-dot">∑</span>
    </div>

    <div class="sidebar-section">CUSTOS</div>
    <div class="sidebar-item" onclick="openModal('modal-custos')">
      <div class="sidebar-num">C</div>
      <div class="sidebar-label">Parâmetros de custo</div>
      <span class="hint-dot">∑</span>
    </div>

    <div class="sidebar-section">POLÍTICA</div>
    <div class="sidebar-item" onclick="openModal('modal-politica')">
      <div class="sidebar-num">P</div>
      <div class="sidebar-label">D, T e intervalo K</div>
      <span class="hint-dot">∑</span>
    </div>

    <div class="sidebar-section">RESULTADO</div>
    <div class="sidebar-item" onclick="openModal('modal-taxa')">
      <div class="sidebar-num">R</div>
      <div class="sidebar-label">Taxa de custo</div>
      <span class="hint-dot">∑</span>
    </div>
  </aside>

  <!-- MAIN -->
  <main>

    <!-- TÍTULO -->
    <div class="ex-header">
      <div class="ex-number-big">KDTS</div>
      <div class="ex-title-block">
        <span class="level-tag">POLÍTICA DE MANUTENÇÃO</span>
        <div class="ex-title">Con costo de degradacion natural y choques</div>
        <div class="ex-subtitle">mistura Weibull · exponencial · delay-time · 9 cenários</div>
      </div>
    </div>

    <!-- DESCRIÇÃO -->
    <div class="param-panel" style="line-height:1.7; font-size:14.5px;">
      Modelo baseado na teoria de <strong style="color:#fff">delay-time</strong>: um defeito surge no instante <strong style="color:var(--accent)">x</strong> (degradação) ou <strong style="color:var(--accent)">z</strong> (choque), mas só causa falha após um período de latência <strong style="color:var(--accent)">h</strong>. A taxa de custo é calculada como:
      <div class="formula-box" style="margin-top:14px;">
        <div class="formula-title">Fórmula central</div>
        c(D, T, K) = E[Custo do ciclo] / E[Duração do ciclo] = SC / SV
      </div>
      <div class="concepts" style="margin-top:14px;">
        <span class="concept-tag">9 cenários</span>
        <span class="concept-tag">Weibull mistura</span>
        <span class="concept-tag">Exponencial choque</span>
        <span class="concept-tag">Delay-time</span>
        <span class="concept-tag">Integração numérica</span>
      </div>
    </div>

    <!-- WEIBULL -->
    <div class="section-label" id="sec-weibull">DEGRADAÇÃO NATURAL — MISTURA WEIBULL</div>
    <div class="param-panel">
      <div class="param-group">
        <div class="group-label">COMPONENTE FRACO</div>
        <div class="param-row">
          <label>n₁</label>
          <span class="desc">Escala da Weibull (componente fraco)</span>
          <input type="number" id="n1" value="0.3" step="0.1" min="0.01">
        </div>
        <div class="param-row">
          <label>b₁</label>
          <span class="desc">Forma da Weibull (componente fraco)</span>
          <input type="number" id="b1" value="3" step="0.5" min="0.1">
        </div>
      </div>
      <div class="param-group">
        <div class="group-label">COMPONENTE FORTE</div>
        <div class="param-row">
          <label>n₂</label>
          <span class="desc">Escala da Weibull (componente forte)</span>
          <input type="number" id="n2" value="3" step="0.1" min="0.01">
        </div>
        <div class="param-row">
          <label>b₂</label>
          <span class="desc">Forma da Weibull (componente forte)</span>
          <input type="number" id="b2" value="3" step="0.5" min="0.1">
        </div>
      </div>
      <div class="param-group" style="margin-bottom:0">
        <div class="group-label">MISTURA</div>
        <div class="param-row">
          <label>a</label>
          <span class="desc">Proporção de componentes fracos (0 &lt; a &lt; 1)</span>
          <input type="number" id="a" value="0.05" step="0.01" min="0" max="1">
        </div>
      </div>
    </div>

    <!-- EXPONENCIAIS -->
    <div class="section-label" id="sec-exp">DELAY-TIME E CHOQUES — EXPONENCIAL</div>
    <div class="param-panel">
      <div class="param-group">
        <div class="group-label">DELAY-TIME</div>
        <div class="param-row">
          <label>λ</label>
          <span class="desc">Taxa exponencial do delay-time (inverso da média)</span>
          <input type="number" id="l" value="1" step="0.1" min="0.01">
        </div>
      </div>
      <div class="param-group" style="margin-bottom:0">
        <div class="group-label">CHOQUES EXTERNOS</div>
        <div class="param-row">
          <label>μ</label>
          <span class="desc">Taxa de chegada dos choques externos</span>
          <input type="number" id="u" value="0.5" step="0.1" min="0.01">
        </div>
      </div>
    </div>

    <!-- CUSTOS -->
    <div class="section-label" id="sec-custos">PARÂMETROS DE CUSTO</div>
    <div class="param-panel">
      <div class="param-group" style="margin-bottom:0">
        <div class="group-label">CUSTOS DE SUBSTITUIÇÃO E INSPEÇÃO</div>
        <div class="param-row">
          <label>cᶠ</label>
          <span class="desc">Custo de substituição corretiva (falha)</span>
          <input type="number" id="cf" value="5" step="0.5" min="0">
        </div>
        <div class="param-row">
          <label>cₚ</label>
          <span class="desc">Custo de substituição preventiva</span>
          <input type="number" id="cp" value="1" step="0.1" min="0">
        </div>
        <div class="param-row">
          <label>cᵢ</label>
          <span class="desc">Custo por inspeção realizada</span>
          <input type="number" id="ci" value="0.1" step="0.05" min="0">
        </div>
        <div class="param-row">
          <label>cₙ</label>
          <span class="desc">Custo unitário de degradação natural</span>
          <input type="number" id="cn" value="0.04" step="0.01" min="0">
        </div>
        <div class="param-row">
          <label>cᶜ</label>
          <span class="desc">Custo unitário de choque externo</span>
          <input type="number" id="cc" value="0.04" step="0.01" min="0">
        </div>
      </div>
    </div>

    <!-- POLÍTICA -->
    <div class="section-label" id="sec-politica">POLÍTICA DE MANUTENÇÃO</div>
    <div class="param-panel">
      <div class="param-group" style="margin-bottom:0">
        <div class="group-label">VARIÁVEIS DE DECISÃO</div>
        <div class="param-row">
          <label>D</label>
          <span class="desc">Intervalo entre inspeções periódicas</span>
          <input type="number" id="D" value="0.9092" step="0.01" min="0.01">
        </div>
        <div class="param-row">
          <label>T</label>
          <span class="desc">Idade de substituição preventiva</span>
          <input type="number" id="T" value="8" step="0.5" min="0.1">
        </div>
        <div class="param-row" style="margin-top:8px; padding-top:12px; border-top:1px solid var(--border);">
          <label>K</label>
          <span class="desc">Número de inspeções <span style="color:var(--accent2); font-size:11px;">(deixe vazio para iterar todos)</span></span>
          <input type="number" id="K" placeholder="auto" step="1" min="0" style="width:86px;">
        </div>
        <div style="margin-top:8px; font-family:'JetBrains Mono',monospace; font-size:11px; color:var(--text-dim); padding: 6px 0;">
          Restrição: K·D ≤ T &nbsp;·&nbsp; K<sub>max</sub> = floor(T / D)
        </div>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="actions">
      <button class="btn btn-primary" id="btnRun" onclick="runModel()">
        <span id="btnIcon">▶</span>
        <span id="btnText">CALCULAR TAXA DE CUSTO</span>
      </button>
      <button class="btn btn-secondary" onclick="resetForm()">RESETAR</button>
    </div>

    <!-- RESULTADO -->
    <div class="section-label" id="sec-resultado">RESULTADO — TAXA DE CUSTO c(D, T, K)</div>
    <div id="outputArea">
      <div class="placeholder">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect x="8" y="8" width="32" height="32" rx="3" stroke="#5a6070" stroke-width="1.5"/>
          <line x1="16" y1="20" x2="32" y2="20" stroke="#5a6070" stroke-width="1.5"/>
          <line x1="16" y1="26" x2="28" y2="26" stroke="#5a6070" stroke-width="1.5"/>
          <line x1="16" y1="32" x2="24" y2="32" stroke="#5a6070" stroke-width="1.5"/>
        </svg>
        <p>Configure os parâmetros acima<br>e clique em CALCULAR</p>
      </div>
    </div>

  </main>
</div>

<div class="toast" id="toast"></div>

<!-- ── MODAL: MISTURA WEIBULL ── -->
<div class="modal-overlay" id="modal-weibull" onclick="closeModalOut(event, 'modal-weibull')">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-icon">W</div>
        <div>
          <div class="modal-title">Mistura Weibull</div>
          <div class="modal-subtitle">DEGRADAÇÃO NATURAL</div>
        </div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-weibull')">✕</button>
    </div>
    <div class="modal-body">

      <div class="formula-card">
        <div class="formula-card-header">Componente Fraco — f₁(x)</div>
        <div class="formula-card-body">
          $$f_1(x) = \frac{\beta_1}{\eta_1}\left(\frac{x}{\eta_1}\right)^{\beta_1-1} \exp\!\left[-\left(\frac{x}{\eta_1}\right)^{\beta_1}\right]$$
        </div>
        <div class="formula-card-desc">
          Representa a fração <code>a</code> da população com vida curta (falhas precoces). Parâmetros: escala <code>η₁</code> e forma <code>β₁</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Componente Forte — f₂(x)</div>
        <div class="formula-card-body">
          $$f_2(x) = \frac{\beta_2}{\eta_2}\left(\frac{x}{\eta_2}\right)^{\beta_2-1} \exp\!\left[-\left(\frac{x}{\eta_2}\right)^{\beta_2}\right]$$
        </div>
        <div class="formula-card-desc">
          Representa a fração <code>1 - a</code> da população com vida mais longa. Parâmetros: escala <code>η₂</code> e forma <code>β₂</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Densidade da Mistura — f(x)</div>
        <div class="formula-card-body">
          $$f(x) = a \cdot f_1(x) + (1 - a) \cdot f_2(x)$$
        </div>
        <div class="formula-card-desc">
          Combinação ponderada das duas Weibull. O parâmetro <code>a</code> controla a proporção de componentes fracos na população.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Confiabilidade da Mistura — R(x)</div>
        <div class="formula-card-body">
          $$R(x) = \int_{x}^{\infty} f(t)\, dt = 1 - F(x)$$
        </div>
        <div class="formula-card-desc">
          Probabilidade de o defeito por degradação ainda não ter chegado até o instante <code>x</code>. Calculada numericamente.
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ── MODAL: DELAY-TIME E CHOQUES ── -->
<div class="modal-overlay" id="modal-exp" onclick="closeModalOut(event, 'modal-exp')">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-icon">E</div>
        <div>
          <div class="modal-title">Delay-time e Choques</div>
          <div class="modal-subtitle">DISTRIBUIÇÕES EXPONENCIAIS</div>
        </div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-exp')">✕</button>
    </div>
    <div class="modal-body">

      <div class="formula-card">
        <div class="formula-card-header">Density do Delay-time — f(h)</div>
        <div class="formula-card-body">
          $$f_h(h) = \lambda\, e^{-\lambda h}, \quad h \geq 0$$
        </div>
        <div class="formula-card-desc">
          O delay-time <code>h</code> é o tempo entre o surgimento do defeito e a falha efetiva. Taxa <code>λ</code>: quanto maior, menor o período de latência médio <code>1/λ</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Acumulada do Delay-time — F(h)</div>
        <div class="formula-card-body">
          $$F_h(h) = 1 - e^{-\lambda h}$$
        </div>
        <div class="formula-card-desc">
          Probabilidade de a falha ocorrer antes de <code>h</code> unidades de tempo após o surgimento do defeito. Usada nos cenários de falha corretiva.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Density dos Choques — f(z)</div>
        <div class="formula-card-body">
          $$f_z(z) = \mu\, e^{-\mu z}, \quad z \geq 0$$
        </div>
        <div class="formula-card-desc">
          O choque externo ocorre no instante <code>z</code>. Taxa <code>μ</code>: quanto maior, mais frequentes os choques. A propriedade de falta de memória implica chegadas aleatórias independentes.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Confiabilidade dos Choques — R(z)</div>
        <div class="formula-card-body">
          $$R_z(z) = e^{-\mu z}$$
        </div>
        <div class="formula-card-desc">
          Probabilidade de nenhum choque ter ocorrido até o instante <code>z</code>. Garante a exclusividade mútua entre os cenários de degradação e de choque.
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ── MODAL: FUNÇÕES DE CUSTO ── -->
<div class="modal-overlay" id="modal-custos" onclick="closeModalOut(event, 'modal-custos')">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-icon">C</div>
        <div>
          <div class="modal-title">Funções de Custo</div>
          <div class="modal-subtitle">9 CENÁRIOS — fc₁ até fc₉</div>
        </div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-custos')">✕</button>
    </div>
    <div class="modal-body">

      <div class="formula-card">
        <div class="formula-card-header">Cenários 1 e 5 — Falha antes da inspeção i (corretiva)</div>
        <div class="formula-card-body">
          $$c_1(h) = c_f + c_i(i-1) + c_n \cdot h \qquad c_5(h) = c_f + c_i(i-1) + c_c \cdot h$$
        </div>
        <div class="formula-card-desc">
          Custo corretivo + <code>(i-1)</code> inspeções já realizadas + custo proporcional ao delay-time <code>h</code>. Diferença: <code>c_n</code> para degradação, <code>c_c</code> para choque.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Cenários 2 e 6 — Detectado na inspeção i (preventiva)</div>
        <div class="formula-card-body">
          $$c_2(x) = c_p + c_i \cdot i + c_n(iD - x) \qquad c_6(z) = c_p + c_i \cdot i + c_c(iD - z)$$
        </div>
        <div class="formula-card-desc">
          Custo preventivo + <code>i</code> inspeções + custo proporcional ao tempo de defeito latente <code>(iD - x)</code> ou <code>(iD - z)</code> sem ser detectado.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Cenários 3 e 7 — Falha entre K·D e T (corretiva)</div>
        <div class="formula-card-body">
          $$c_3(h) = c_f + c_i K + c_n \cdot h \qquad c_7(h) = c_f + c_i K + c_c \cdot h$$
        </div>
        <div class="formula-card-desc">
          Falha ocorre no período final após as <code>K</code> inspeções, antes de atingir a idade <code>T</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Cenários 4 e 8 — Sobrevive até T (preventiva por idade)</div>
        <div class="formula-card-body">
          $$c_4(x) = c_p + c_i K + c_n(T - x) \qquad c_8(z) = c_p + c_i K + c_c(T - z)$$
        </div>
        <div class="formula-card-desc">
          Defeito presente mas o componente é substituído ao atingir a idade <code>T</code>. Custo proporcional ao tempo latente <code>(T - x)</code> ou <code>(T - z)</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Cenário 9 — Sem defeito até T</div>
        <div class="formula-card-body">
          $$c_9 = c_p + c_i K$$
        </div>
        <div class="formula-card-desc">
          Nenhum defeito até <code>T</code>. Substituição puramente preventiva por idade. Apenas custo preventivo e <code>K</code> inspeções realizadas.
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ── MODAL: TAXA DE CUSTO ── -->
<div class="modal-overlay" id="modal-taxa" onclick="closeModalOut(event, 'modal-taxa')">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-icon">R</div>
        <div>
          <div class="modal-title">Taxa de Custo</div>
          <div class="modal-subtitle">RESULTADO — c(D, T, K)</div>
        </div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-taxa')">✕</button>
    </div>
    <div class="modal-body">

      <div class="formula-card">
        <div class="formula-card-header">Fórmula Central</div>
        <div class="formula-card-body">
          $$c(D,T,K) = \frac{SC}{SV} = \frac{E[\text{Custo do ciclo}]}{E[\text{Duração do ciclo}]}$$
        </div>
        <div class="formula-card-desc">
          A taxa de custo é a razão entre o custo esperado total do ciclo <code>SC</code> e a vida esperada do ciclo <code>SV</code>. Minimizada sobre os parâmetros <code>D</code>, <code>T</code> e <code>K</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Custo Esperado — SC</div>
        <div class="formula-card-body">
          $$SC = \sum_{j=1}^{9} E[c_j \cdot \mathbf{1}_{\text{cenário }j}]$$
        </div>
        <div class="formula-card-desc">
          Soma ponderada dos custos de cada cenário pela sua probabilidade de ocorrência. Inclui custos corretivos <code>c_f</code>, preventivos <code>c_p</code>, inspeções <code>c_i</code> e custos de latência <code>c_n</code>, <code>c_c</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Vida Esperada — SV</div>
        <div class="formula-card-body">
          $$SV = \sum_{j=1}^{9} E[v_j \cdot \mathbf{1}_{\text{cenário }j}]$$
        </div>
        <div class="formula-card-desc">
          Duração esperada do ciclo ponderada pela probabilidade de cada cenário. Para cenários com falha: <code>v = x + h</code> ou <code>v = z + h</code>. Para preventivos: <code>v = i·D</code> ou <code>v = T</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Restrição e K ótimo</div>
        <div class="formula-card-body">
          $$K \in \{0, 1, \ldots, K_{\max}\}, \quad K_{\max} = \left\lfloor \frac{T}{D} \right\rfloor$$
        </div>
        <div class="formula-card-desc">
          O K ótimo é aquele que minimiza <code>c(D, T, K)</code>. O código itera todos os valores válidos e seleciona o de menor taxa.
        </div>
      </div>

    </div>
  </div>
</div>
<div class="modal-overlay" id="modal-politica" onclick="closeModalOut(event, 'modal-politica')">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-icon">P</div>
        <div>
          <div class="modal-title">Política de Manutenção</div>
          <div class="modal-subtitle">TAXA DE CUSTO — FÓRMULA COMPLETA</div>
        </div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-politica')">✕</button>
    </div>
    <div class="modal-body">

      <div class="formula-card">
        <div class="formula-card-header">Taxa de Custo</div>
        <div class="formula-card-body">
          $$c(D,T,K) = \frac{E[\text{Custo do ciclo}]}{E[\text{Duração do ciclo}]} = \frac{SC}{SV}$$
        </div>
        <div class="formula-card-desc">
          Razão entre o custo esperado total e a vida esperada do ciclo. Minimizada sobre <code>D</code>, <code>T</code> e <code>K</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Restrição da Política</div>
        <div class="formula-card-body">
          $$K \cdot D \leq T \qquad K_{\max} = \left\lfloor \frac{T}{D} \right\rfloor$$
        </div>
        <div class="formula-card-desc">
          As <code>K</code> inspeções periódicas devem ocorrer antes da substituição preventiva em <code>T</code>. O número máximo de inspeções é o piso de <code>T/D</code>.
        </div>
      </div>

      <div class="formula-card">
        <div class="formula-card-header">Probabilidade de cada Cenário — Verificação</div>
        <div class="formula-card-body">
          $$\sum_{j=1}^{9} P(\text{Cenário } j) = 1$$
        </div>
        <div class="formula-card-desc">
          Os 9 cenários são mutuamente exclusivos e coletivamente exaustivos. A soma das probabilidades deve ser igual a 1 para cada combinação válida de <code>(D, T, K)</code>.
        </div>
      </div>

    </div>
  </div>
</div>

<script>
// ─── INTEGRAÇÃO NUMÉRICA ─────────────────────────────────────────────────────
function integrate(f, a, b, n = 1000) {
  if (a >= b) return 0;
  const h = (b - a) / n;
  let s = f(a) + f(b);
  for (let i = 1; i < n; i++) s += (i % 2 === 0 ? 2 : 4) * f(a + i * h);
  return s * h / 3;
}

function integrate2(f, ax, bx, upper, nx = 200, nh = 200) {
  if (ax >= bx) return 0;
  const hx = (bx - ax) / nx;
  let sx = 0;
  for (let i = 0; i <= nx; i++) {
    const x = ax + i * hx;
    const bu = upper(x);
    if (bu <= 0) continue;
    const inner = integrate(h => f(h, x), 0, bu, nh);
    const w = (i === 0 || i === nx) ? 1 : (i % 2 === 0 ? 2 : 4);
    sx += w * inner;
  }
  return sx * hx / 3;
}

// ─── CÁLCULO DO MODELO ───────────────────────────────────────────────────────
function computeCost(p, K) {
  const { n1, b1, n2, b2, a, l, u, ci, cp, cf, cn, cc, D, T } = p;

  // Distribuições
  const f01 = x => (b1/n1) * Math.pow(x/n1, b1-1) * Math.exp(-Math.pow(x/n1, b1));
  const f02 = x => (b2/n2) * Math.pow(x/n2, b2-1) * Math.exp(-Math.pow(x/n2, b2));
  const fx  = x => a*f01(x) + (1-a)*f02(x);
  const Rx  = t => integrate(fx, t, Math.max(t+20, 30), 800);
  const fz  = z => u * Math.exp(-u*z);
  const Rz  = z => Math.exp(-u*z);
  const fh  = h => l * Math.exp(-l*h);
  const Fh  = h => 1 - Math.exp(-l*h);
  const Rh  = h => Math.exp(-l*h);

  // Funções de custo — fc1..fc9
  const fc3 = h => cf + ci*K + cn*h;
  const fc4 = x => cp + ci*K + cn*(T-x);
  const fc7 = h => cf + ci*K + cc*h;
  const fc8 = z => cp + ci*K + cc*(T-z);
  const fc9 = cp + ci*K;

  let sc = 0, sv = 0;

  // Casos 1,2,5,6 — dentro das inspeções periódicas
  for (let i = 1; i <= K; i++) {
    const lo = (i-1)*D, hi = i*D;
    const fc1 = h => cf + ci*(i-1) + cn*h;
    const fc2 = x => cp + ci*i + cn*(i*D - x);
    const fc5 = h => cf + ci*(i-1) + cc*h;
    const fc6 = z => cp + ci*i + cc*(i*D - z);

    // CASO 01 — degradação natural, falha antes da inspeção i
    sc += integrate2((h,x) => fc1(h)*Rz(x)*fx(x)*fh(h), lo, hi, x => i*D - x);
    sv += integrate2((h,x) => (x+h)*Rz(x)*fx(x)*fh(h), lo, hi, x => i*D - x);

    // CASO 02 — degradação natural, detectado na inspeção i
    sc += integrate(x => fc2(x)*Rz(x)*fx(x)*Rh(i*D - x), lo, hi);
    sv += integrate(x => (i*D)*Rz(x)*fx(x)*Rh(i*D - x), lo, hi);

    // CASO 05 — choque, falha antes da inspeção i
    sc += integrate2((h,z) => fc5(h)*Rx(z)*fz(z)*fh(h), lo, hi, z => i*D - z);
    sv += integrate2((h,z) => (z+h)*Rx(z)*fz(z)*fh(h), lo, hi, z => i*D - z);

    // CASO 06 — choque, detectado na inspeção i
    sc += integrate(z => fc6(z)*fz(z)*Rx(z)*Rh(i*D - z), lo, hi);
    sv += integrate(z => (i*D)*fz(z)*Rx(z)*Rh(i*D - z), lo, hi);
  }

  // Casos 3,4,7,8 — após a última inspeção até T
  // CASO 03 — degradação natural, falha antes de T
  sc += integrate2((h,x) => fc3(h)*Rz(x)*fx(x)*fh(h), K*D, T, x => T - x);
  sv += integrate2((h,x) => (x+h)*Rz(x)*fx(x)*fh(h), K*D, T, x => T - x);

  // CASO 04 — degradação natural, sobrevive até T
  const p4 = integrate(x => Rz(x)*fx(x)*Rh(T - x), K*D, T);
  sc += integrate(x => fc4(x)*Rz(x)*fx(x)*Rh(T - x), K*D, T);
  sv += T * p4;

  // CASO 07 — choque, falha antes de T
  sc += integrate2((h,z) => fc7(h)*fz(z)*Rx(z)*fh(h), K*D, T, z => T - z);
  sv += integrate2((h,z) => (z+h)*fz(z)*Rx(z)*fh(h), K*D, T, z => T - z);

  // CASO 08 — choque, sobrevive até T
  const p8 = integrate(z => fz(z)*Rx(z)*Rh(T - z), K*D, T);
  sc += integrate(z => fc8(z)*fz(z)*Rx(z)*Rh(T - z), K*D, T);
  sv += T * p8;

  // CASO 09 — sem defeito até T
  const p9 = Rz(T) * Rx(T);
  sc += fc9 * p9;
  sv += T  * p9;

  return sv > 0 ? sc / sv : Infinity;
}

// ─── UI ──────────────────────────────────────────────────────────────────────
function getParams() {
  const Kval = document.getElementById('K').value;
  return {
    n1: +document.getElementById('n1').value,
    b1: +document.getElementById('b1').value,
    n2: +document.getElementById('n2').value,
    b2: +document.getElementById('b2').value,
    a:  +document.getElementById('a').value,
    l:  +document.getElementById('l').value,
    u:  +document.getElementById('u').value,
    ci: +document.getElementById('ci').value,
    cp: +document.getElementById('cp').value,
    cf: +document.getElementById('cf').value,
    cn: +document.getElementById('cn').value,
    cc: +document.getElementById('cc').value,
    D:  +document.getElementById('D').value,
    T:  +document.getElementById('T').value,
    K_fixed: Kval === '' ? null : +Kval,
  };
}

function runModel() {
  const p = getParams();
  const K_max = Math.floor(p.T / p.D);

  if (K_max < 0 || isNaN(K_max)) {
    showOutput(`<div class="error-box">⚠ Parâmetros inválidos. Verifique D e T.</div>`);
    return;
  }

  // Modo K fixo: calcula só para esse K
  if (p.K_fixed !== null) {
    const K = p.K_fixed;
    if (K < 0 || K > K_max) {
      showOutput(`<div class="error-box">⚠ K = ${K} inválido. Deve estar entre 0 e K<sub>max</sub> = ${K_max}.</div>`);
      return;
    }
    setRunning(true);
    showOutput(`<div class="progress-wrap"><div class="progress-top"><span>Calculando para K = ${K}...</span><span id="progPct">—</span></div><div class="progress-track"><div class="progress-fill" id="progFill" style="width:50%;animation:none;"></div></div></div>`);
    setTimeout(() => {
      const c = computeCost(p, K);
      setRunning(false);
      showOutput(`
        <div class="results-wrap">
          <div class="summary-cards">
            <div class="card">
              <div class="card-label">K calculado</div>
              <div class="card-value">${K}</div>
              <div class="card-sub">${K} inspeções no ciclo</div>
            </div>
            <div class="card">
              <div class="card-label">Taxa de custo</div>
              <div class="card-value">${c.toFixed(4)}</div>
              <div class="card-sub">custo / unidade de tempo</div>
            </div>
          </div>
          <table class="results-table">
            <thead><tr><th>K</th><th>Taxa de custo &nbsp; c(D, T, K)</th></tr></thead>
            <tbody><tr class="best"><td class="k-col">${K}</td><td class="c-col">${c.toFixed(6)}<span class="best-badge">CALCULADO</span></td></tr></tbody>
          </table>
          <div class="formula-box">
            <div class="formula-title">Parâmetros utilizados</div>
            D = ${p.D} &nbsp;·&nbsp; T = ${p.T} &nbsp;·&nbsp; K = ${K} (fixo)<br>
            cᶠ = ${p.cf} &nbsp;·&nbsp; cₚ = ${p.cp} &nbsp;·&nbsp; cᵢ = ${p.ci} &nbsp;·&nbsp; cₙ = ${p.cn} &nbsp;·&nbsp; cᶜ = ${p.cc}
          </div>
        </div>`);
      showToast(`✓ K=${K} → c = ${c.toFixed(6)}`);
    }, 0);
    return;
  }

  // Modo auto: itera de 0 até K_max
  setRunning(true);
  showOutput(`
    <div class="progress-wrap" id="progressWrap">
      <div class="progress-top">
        <span>Calculando K = <span id="progK">0</span> de ${K_max}</span>
        <span id="progPct">0%</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progFill"></div>
      </div>
    </div>
    <div class="formula-box">
      <div class="formula-title">Cenários ativos</div>
      01–02: degradação natural nas inspeções &nbsp;|&nbsp; 03–04: degradação após K·D<br>
      05–06: choque nas inspeções &nbsp;|&nbsp; 07–08: choque após K·D &nbsp;|&nbsp; 09: sem defeito até T
    </div>
  `);

  const results = [];
  let K = 0;

  function step() {
    if (K > K_max) {
      setRunning(false);
      showResults(results, p, K_max);
      showToast('✓ Cálculo concluído — K=' + results.reduce((b,r) => r.c < b.c ? r : b, results[0]).K + ' é o ótimo');
      return;
    }
    results.push({ K, c: computeCost(p, K) });
    const pct = Math.round((K / K_max) * 100);
    const progK   = document.getElementById('progK');
    const progPct = document.getElementById('progPct');
    const progFill= document.getElementById('progFill');
    if (progK)    progK.textContent    = K;
    if (progPct)  progPct.textContent  = pct + '%';
    if (progFill) progFill.style.width = pct + '%';
    K++;
    setTimeout(step, 0);
  }
  setTimeout(step, 0);
}

function showResults(results, p, K_max) {
  const best = results.reduce((b,r) => r.c < b.c ? r : b, results[0]);

  const rows = results.map(r => `
    <tr class="${r.K === best.K ? 'best' : ''}">
      <td class="k-col">${r.K}</td>
      <td class="c-col">${r.c.toFixed(6)}${r.K === best.K ? '<span class="best-badge">MÍNIMO</span>' : ''}</td>
    </tr>`).join('');

  showOutput(`
    <div class="results-wrap">
      <div class="summary-cards">
        <div class="card">
          <div class="card-label">K ótimo</div>
          <div class="card-value">${best.K}</div>
          <div class="card-sub">${best.K} inspeções no ciclo</div>
        </div>
        <div class="card">
          <div class="card-label">Taxa mínima</div>
          <div class="card-value">${best.c.toFixed(4)}</div>
          <div class="card-sub">custo / unidade de tempo</div>
        </div>
      </div>

      <table class="results-table">
        <thead>
          <tr>
            <th>K</th>
            <th>Taxa de custo &nbsp; c(D, T, K)</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>

      <div class="formula-box">
        <div class="formula-title">Parâmetros utilizados</div>
        D = ${p.D} &nbsp;·&nbsp; T = ${p.T} &nbsp;·&nbsp; K_max = ${K_max}<br>
        cᶠ = ${p.cf} &nbsp;·&nbsp; cₚ = ${p.cp} &nbsp;·&nbsp; cᵢ = ${p.ci} &nbsp;·&nbsp; cₙ = ${p.cn} &nbsp;·&nbsp; cᶜ = ${p.cc}
      </div>
    </div>
  `);
}

function showOutput(html) {
  document.getElementById('outputArea').innerHTML = html;
}

function setRunning(on) {
  const btn  = document.getElementById('btnRun');
  const icon = document.getElementById('btnIcon');
  const text = document.getElementById('btnText');
  btn.disabled = on;
  if (on) {
    icon.outerHTML = '<span class="spinner" id="btnIcon"></span>';
    text.textContent = 'CALCULANDO...';
  } else {
    const el = document.getElementById('btnIcon');
    if (el) el.outerHTML = '<span id="btnIcon">▶</span>';
    text.textContent = 'CALCULAR TAXA DE CUSTO';
  }
}

function resetForm() {
  document.getElementById('n1').value = '0.3';
  document.getElementById('b1').value = '3';
  document.getElementById('n2').value = '3';
  document.getElementById('b2').value = '3';
  document.getElementById('a').value  = '0.05';
  document.getElementById('l').value  = '1';
  document.getElementById('u').value  = '0.5';
  document.getElementById('ci').value = '0.1';
  document.getElementById('cp').value = '1';
  document.getElementById('cf').value = '5';
  document.getElementById('cn').value = '0.04';
  document.getElementById('cc').value = '0.04';
  document.getElementById('D').value  = '0.9092';
  document.getElementById('T').value  = '8';
  document.getElementById('K').value  = '';
  showOutput(`<div class="placeholder">
    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
      <rect x="8" y="8" width="32" height="32" rx="3" stroke="#5a6070" stroke-width="1.5"/>
      <line x1="16" y1="20" x2="32" y2="20" stroke="#5a6070" stroke-width="1.5"/>
      <line x1="16" y1="26" x2="28" y2="26" stroke="#5a6070" stroke-width="1.5"/>
      <line x1="16" y1="32" x2="24" y2="32" stroke="#5a6070" stroke-width="1.5"/>
    </svg>
    <p>Configure os parâmetros acima<br>e clique em CALCULAR</p>
  </div>`);
}

function scrollTo(id) {
  document.querySelectorAll('.sidebar-item').forEach(e => e.classList.remove('active'));
  event.currentTarget.classList.add('active');
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ─── MODAIS ──────────────────────────────────────────────────────────────────
function openModal(id) {
  const overlay = document.getElementById(id);
  overlay.classList.add('open');
  document.body.style.overflow = 'hidden';
  // Renderiza MathJax dentro do modal após abrir
  if (window.MathJax) {
    MathJax.typesetPromise([overlay]).catch(err => console.log(err));
  }
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
  document.body.style.overflow = '';
}

function closeModalOut(event, id) {
  if (event.target === document.getElementById(id)) closeModal(id);
}

// Fecha modal com ESC
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay.open').forEach(m => {
      m.classList.remove('open');
      document.body.style.overflow = '';
    });
  }
});
</script>
</body>
</html>
